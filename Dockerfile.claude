FROM ubuntu:24.04
ENV DEBIAN_FRONTEND=noninteractive

RUN install -d -m 0755 /usr/local/bin
COPY scripts/apt-install /usr/local/bin/apt-install
COPY scripts/apt-packages-common /usr/local/share/apt-packages-common
RUN chmod +x /usr/local/bin/apt-install

# Install curl and supplementary tools
RUN apt-install $(cat /usr/local/share/apt-packages-common) \
    ca-certificates

# Install Claude Code using the provided command
RUN curl -fsSL https://claude.ai/install.sh | bash

# Add Claude to PATH (installed to ~/.local/bin by the script)
ENV PATH="/root/.local/bin:${PATH}"

# Set the default working directory
WORKDIR /workspace

# Ensure /usr/local/bin exists and add the tmux layout script
ADD scripts/start-tmux-layout /usr/local/bin/start-tmux-layout
RUN chmod +x /usr/local/bin/start-tmux-layout

# Start the tmux layout on login
CMD ["-lc", "start-tmux-layout"]
